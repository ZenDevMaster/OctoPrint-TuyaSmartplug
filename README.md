# OctoPrint-TuyaSmartplug

Control [Tuya-based](https://en.tuya.com/) smart plugs directly from the OctoPrint web interface or through GCODE commands.

This fork adds support for **Tuya protocol versions 3.4 and 3.5** by replacing the bundled pytuya library with [TinyTuya](https://github.com/jasonacox/tinytuya).

## Acknowledgments

This plugin stands on the shoulders of giants:

- [jneilliii](https://github.com/jneilliii) - Original author of [OctoPrint-TPLinkSmartplug](https://github.com/jneilliii/OctoPrint-TPLinkSmartplug), which forms the foundation of this plugin's code
- [ziirish](https://github.com/ziirish) - Maintained the [OctoPrint-TuyaSmartplug](https://github.com/ziirish/OctoPrint-TuyaSmartplug) fork
- [clach04](https://github.com/clach04) - Created [python-tuya](https://github.com/clach04/python-tuya)
- [jasonacox](https://github.com/jasonacox) - Creator of [TinyTuya](https://github.com/jasonacox/tinytuya), which powers this fork's modern protocol support

## Disclaimer

**This plugin is provided as-is, without active development or support.** We created this fork to add protocol 3.4/3.5 support for our own use. The community is welcome to use it, fork it, or submit pull requests, but please understand that responses may be slow or non-existent.

**Use at your own risk.** Controlling your 3D printer's power supply remotely carries inherent risks:

- Cutting power during a print can damage your printer or cause fires
- Unexpected power cycles can corrupt SD cards or damage electronics
- You are solely responsible for any damage to your equipment, property, or person

Always ensure your printer is in a safe state before toggling power remotely.

## Installation

Install via OctoPrint's Plugin Manager using this URL:

```
https://github.com/ZenDevMaster/OctoPrint-TuyaSmartplug/archive/refs/heads/master.zip
```

Or install manually via pip:

```bash
pip install git+https://github.com/ZenDevMaster/OctoPrint-TuyaSmartplug.git
```

## Getting Your Device ID and Local Key

This plugin requires your Tuya device's **Device ID**, **IP Address**, and **Local Key** to communicate with your smart plug.

The easiest way to obtain these is using the [TinyTuya](https://github.com/jasonacox/tinytuya) setup wizard:

1. Install TinyTuya: `pip install tinytuya`
2. Run the wizard: `python -m tinytuya wizard`
3. Follow the instructions to link your Tuya developer account
4. The wizard will generate a `devices.json` file with all your device information

For detailed instructions, see the [TinyTuya Setup Guide](https://github.com/jasonacox/tinytuya#setup-wizard---getting-local-keys).

## Configuration

1. Go to **Settings** > **Tuya Smartplug** in OctoPrint
2. Click the **+** button to add a new plug
3. Enter your device's:
   - **IP Address** - Local IP of your smart plug
   - **Device ID** - From TinyTuya wizard
   - **Local Key** - From TinyTuya wizard
   - **Protocol Version** - Select 3.1, 3.3, 3.4, or 3.5 (most newer devices use 3.4 or 3.5)
4. Configure additional options as desired (auto-connect, warnings, etc.)

## Protocol Version

If you're unsure which protocol version your device uses, check the `devices.json` or `snapshot.json` file generated by the TinyTuya wizard - it includes the version for each device.

- **3.1** - Older devices
- **3.3** - Common for devices from 2019-2021
- **3.4** - Newer devices (2022+)
- **3.5** - Latest devices (2023+)
